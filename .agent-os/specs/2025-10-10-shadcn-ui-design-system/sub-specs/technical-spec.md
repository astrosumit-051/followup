# Technical Specification

This is the technical specification for the spec detailed in @.agent-os/specs/2025-10-10-shadcn-ui-design-system/spec.md

> Created: 2025-10-10
> Version: 1.0.0

## Technical Requirements

### shadcn/ui Initialization

**Installation Command:**
```bash
npx shadcn@latest init
```

**Configuration Answers:**
- Style: Default
- Base color: Slate
- CSS variables: Yes (enables theming)
- Global CSS file: `app/globals.css`
- Tailwind config: `tailwind.config.ts`
- Components directory: `@/components`
- Utils directory: `@/lib/utils`
- React Server Components: Yes
- TypeScript: Yes

**Post-Init Changes:**
```typescript
// apps/web/components.json (generated by shadcn init)
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "app/globals.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils"
  }
}
```

### Design Token Architecture

**Three-Tier Token Hierarchy:**

1. **Core Tokens** (Primitive values)
2. **Semantic Tokens** (Purpose-driven mappings)
3. **Component Tokens** (Component-specific overrides)

**Implementation in `apps/web/app/globals.css`:**

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Core Tokens - Primitive Colors */
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;

    /* Semantic Tokens - UI Purpose */
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;

    --primary: 221.2 83.2% 53.3%;
    --primary-foreground: 210 40% 98%;

    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;

    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;

    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;

    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 221.2 83.2% 53.3%;

    --radius: 0.5rem;
  }

  .dark {
    /* Dark Mode Semantic Tokens */
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;

    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;

    --primary: 217.2 91.2% 59.8%;
    --primary-foreground: 222.2 47.4% 11.2%;

    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;

    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;

    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;

    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 224.3 76.3% 48%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}
```

**Tailwind Config Integration:**

```typescript
// apps/web/tailwind.config.ts
import type { Config } from 'tailwindcss';

const config: Config = {
  darkMode: ['class'],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    container: {
      center: true,
      padding: '2rem',
      screens: {
        '2xl': '1400px',
      },
    },
    extend: {
      colors: {
        border: 'hsl(var(--border))',
        input: 'hsl(var(--input))',
        ring: 'hsl(var(--ring))',
        background: 'hsl(var(--background))',
        foreground: 'hsl(var(--foreground))',
        primary: {
          DEFAULT: 'hsl(var(--primary))',
          foreground: 'hsl(var(--primary-foreground))',
        },
        secondary: {
          DEFAULT: 'hsl(var(--secondary))',
          foreground: 'hsl(var(--secondary-foreground))',
        },
        destructive: {
          DEFAULT: 'hsl(var(--destructive))',
          foreground: 'hsl(var(--destructive-foreground))',
        },
        muted: {
          DEFAULT: 'hsl(var(--muted))',
          foreground: 'hsl(var(--muted-foreground))',
        },
        accent: {
          DEFAULT: 'hsl(var(--accent))',
          foreground: 'hsl(var(--accent-foreground))',
        },
        popover: {
          DEFAULT: 'hsl(var(--popover))',
          foreground: 'hsl(var(--popover-foreground))',
        },
        card: {
          DEFAULT: 'hsl(var(--card))',
          foreground: 'hsl(var(--card-foreground))',
        },
      },
      borderRadius: {
        lg: 'var(--radius)',
        md: 'calc(var(--radius) - 2px)',
        sm: 'calc(var(--radius) - 4px)',
      },
      keyframes: {
        'accordion-down': {
          from: { height: '0' },
          to: { height: 'var(--radix-accordion-content-height)' },
        },
        'accordion-up': {
          from: { height: 'var(--radix-accordion-content-height)' },
          to: { height: '0' },
        },
      },
      animation: {
        'accordion-down': 'accordion-down 0.2s ease-out',
        'accordion-up': 'accordion-up 0.2s ease-out',
      },
    },
  },
  plugins: [require('tailwindcss-animate')],
};

export default config;
```

### Component Installation Strategy

**Phase 1: Core Primitives (Install First)**
```bash
npx shadcn@latest add button
npx shadcn@latest add input
npx shadcn@latest add label
npx shadcn@latest add textarea
npx shadcn@latest add select
```

**Phase 2: Form & Validation**
```bash
npx shadcn@latest add form
npx shadcn@latest add alert
```

**Phase 3: Layout Components**
```bash
npx shadcn@latest add card
npx shadcn@latest add separator
npx shadcn@latest add badge
npx shadcn@latest add avatar
```

**Phase 4: Dialogs & Overlays**
```bash
npx shadcn@latest add dialog
npx shadcn@latest add alert-dialog
npx shadcn@latest add sheet
npx shadcn@latest add dropdown-menu
npx shadcn@latest add popover
```

**Phase 5: Feedback & Loading**
```bash
npx shadcn@latest add skeleton
npx shadcn@latest add progress
npx shadcn@latest add toast
```

**Phase 6: Data Display**
```bash
npx shadcn@latest add table
npx shadcn@latest add tabs
```

**Total Components: 20**

### Refactoring Approach

#### ContactForm Component

**Before (Custom Tailwind - 400 lines):**
```typescript
// apps/web/components/contacts/ContactForm.tsx
export function ContactForm({ contact, onSubmit }: ContactFormProps) {
  const { register, handleSubmit, formState: { errors } } = useForm<ContactFormData>({
    resolver: zodResolver(contactSchema),
  });

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      <div>
        <label className="block text-sm font-medium text-gray-700">
          Name *
        </label>
        <input
          {...register('name')}
          className="mt-1 block w-full rounded-md border-gray-300 shadow-sm
                     focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
        />
        {errors.name && (
          <p className="mt-1 text-sm text-red-600">{errors.name.message}</p>
        )}
      </div>
      {/* 15 more fields with similar patterns... */}
    </form>
  );
}
```

**After (shadcn/ui - 200 lines):**
```typescript
// apps/web/components/contacts/ContactForm.tsx
import { zodResolver } from '@hookform/resolvers/zod';
import { useForm } from 'react-hook-form';
import { Button } from '@/components/ui/button';
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';

export function ContactForm({ contact, onSubmit }: ContactFormProps) {
  const form = useForm<ContactFormData>({
    resolver: zodResolver(contactSchema),
    defaultValues: contact,
  });

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
        <FormField
          control={form.control}
          name="name"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Name *</FormLabel>
              <FormControl>
                <Input placeholder="John Doe" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <FormField
          control={form.control}
          name="priority"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Priority</FormLabel>
              <Select onValueChange={field.onChange} defaultValue={field.value}>
                <FormControl>
                  <SelectTrigger>
                    <SelectValue placeholder="Select priority" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  <SelectItem value="HIGH">High</SelectItem>
                  <SelectItem value="MEDIUM">Medium</SelectItem>
                  <SelectItem value="LOW">Low</SelectItem>
                </SelectContent>
              </Select>
              <FormMessage />
            </FormItem>
          )}
        />

        <Button type="submit">Save Contact</Button>
      </form>
    </Form>
  );
}
```

**Benefits:**
- 50% less code (400 → 200 lines)
- Zero custom Tailwind classes
- Built-in accessibility (ARIA labels, focus management)
- Consistent validation UI
- Dark mode automatic

#### ContactCard Component

**Before (Custom Styling - 150 lines):**
```typescript
// apps/web/components/contacts/ContactCard.tsx
export function ContactCard({ contact }: ContactCardProps) {
  return (
    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 hover:shadow-lg
                    transition-shadow duration-200 border border-gray-200 dark:border-gray-700">
      <div className="flex items-start justify-between">
        <div className="flex items-center space-x-4">
          <div className="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center
                          text-white font-semibold text-lg">
            {contact.name.charAt(0)}
          </div>
          <div>
            <h3 className="text-lg font-semibold text-gray-900 dark:text-white">
              {contact.name}
            </h3>
            <p className="text-sm text-gray-600 dark:text-gray-400">
              {contact.email}
            </p>
          </div>
        </div>
        <span className={`px-2 py-1 text-xs font-medium rounded-full ${
          contact.priority === 'HIGH'
            ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'
            : contact.priority === 'MEDIUM'
            ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'
            : 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'
        }`}>
          {contact.priority}
        </span>
      </div>
    </div>
  );
}
```

**After (shadcn/ui - 80 lines):**
```typescript
// apps/web/components/contacts/ContactCard.tsx
import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Badge } from '@/components/ui/badge';

export function ContactCard({ contact }: ContactCardProps) {
  return (
    <Card className="hover:shadow-lg transition-shadow duration-200">
      <CardHeader>
        <div className="flex items-start justify-between">
          <div className="flex items-center space-x-4">
            <Avatar>
              <AvatarImage src={contact.profilePicture} />
              <AvatarFallback>{contact.name.charAt(0)}</AvatarFallback>
            </Avatar>
            <div>
              <h3 className="text-lg font-semibold">{contact.name}</h3>
              <p className="text-sm text-muted-foreground">{contact.email}</p>
            </div>
          </div>
          <Badge variant={getPriorityVariant(contact.priority)}>
            {contact.priority}
          </Badge>
        </div>
      </CardHeader>
    </Card>
  );
}

function getPriorityVariant(priority: Priority): 'destructive' | 'default' | 'secondary' {
  switch (priority) {
    case 'HIGH': return 'destructive';
    case 'MEDIUM': return 'default';
    case 'LOW': return 'secondary';
  }
}
```

**Benefits:**
- 47% less code (150 → 80 lines)
- Semantic component names (Card, Avatar, Badge)
- Dark mode via CSS variables (no conditional classes)
- Accessible Avatar with proper fallback
- Reusable Badge variants

#### ContactDeleteDialog Component

**Before (Basic Modal - 100 lines):**
```typescript
// apps/web/components/contacts/ContactDeleteDialog.tsx
export function ContactDeleteDialog({ contact, isOpen, onClose, onConfirm }: Props) {
  return (
    <>
      {isOpen && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
            <h2 className="text-xl font-semibold text-gray-900 dark:text-white mb-4">
              Delete Contact
            </h2>
            <p className="text-gray-600 dark:text-gray-400 mb-6">
              Are you sure you want to delete {contact.name}? This action cannot be undone.
            </p>
            <div className="flex justify-end space-x-3">
              <button
                onClick={onClose}
                className="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100
                           hover:bg-gray-200 rounded-md"
              >
                Cancel
              </button>
              <button
                onClick={onConfirm}
                className="px-4 py-2 text-sm font-medium text-white bg-red-600
                           hover:bg-red-700 rounded-md"
              >
                Delete
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
```

**After (shadcn AlertDialog - 60 lines):**
```typescript
// apps/web/components/contacts/ContactDeleteDialog.tsx
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';

export function ContactDeleteDialog({ contact, isOpen, onClose, onConfirm }: Props) {
  return (
    <AlertDialog open={isOpen} onOpenChange={onClose}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>Delete Contact</AlertDialogTitle>
          <AlertDialogDescription>
            Are you sure you want to delete {contact.name}? This action cannot be undone.
          </AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel>Cancel</AlertDialogCancel>
          <AlertDialogAction onClick={onConfirm} className="bg-destructive text-destructive-foreground hover:bg-destructive/90">
            Delete
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}
```

**Benefits:**
- 40% less code (100 → 60 lines)
- Built-in accessibility (focus trap, Escape key, click outside)
- Proper semantic structure (AlertDialogTitle for screen readers)
- No z-index management
- No manual backdrop implementation

### Dark Mode Implementation

**Setup with next-themes:**

```bash
pnpm add next-themes
```

**Theme Provider:**
```typescript
// apps/web/components/theme-provider.tsx
'use client';

import * as React from 'react';
import { ThemeProvider as NextThemesProvider } from 'next-themes';
import { type ThemeProviderProps } from 'next-themes/dist/types';

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
}
```

**Root Layout Integration:**
```typescript
// apps/web/app/layout.tsx
import { ThemeProvider } from '@/components/theme-provider';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          {children}
        </ThemeProvider>
      </body>
    </html>
  );
}
```

**Theme Toggle Component:**
```typescript
// apps/web/components/theme-toggle.tsx
'use client';

import * as React from 'react';
import { Moon, Sun } from 'lucide-react';
import { useTheme } from 'next-themes';

import { Button } from '@/components/ui/button';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';

export function ThemeToggle() {
  const { setTheme } = useTheme();

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="icon">
          <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
          <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
          <span className="sr-only">Toggle theme</span>
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end">
        <DropdownMenuItem onClick={() => setTheme('light')}>
          Light
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => setTheme('dark')}>
          Dark
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => setTheme('system')}>
          System
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
```

### TypeScript Integration Patterns

**Component Type Safety:**
```typescript
// Example: Form field with proper typing
import { Control } from 'react-hook-form';
import { FormField, FormItem, FormLabel, FormControl, FormMessage } from '@/components/ui/form';
import { Input } from '@/components/ui/input';

interface TypedFormFieldProps {
  control: Control<ContactFormData>;
  name: keyof ContactFormData;
  label: string;
  placeholder?: string;
}

export function TypedFormField({ control, name, label, placeholder }: TypedFormFieldProps) {
  return (
    <FormField
      control={control}
      name={name}
      render={({ field }) => (
        <FormItem>
          <FormLabel>{label}</FormLabel>
          <FormControl>
            <Input placeholder={placeholder} {...field} />
          </FormControl>
          <FormMessage />
        </FormItem>
      )}
    />
  );
}
```

**Variant Typing:**
```typescript
// Extending shadcn component variants
import { buttonVariants } from '@/components/ui/button';
import { cn } from '@/lib/utils';

// Custom variant with type safety
const iconButtonVariants = cva(
  buttonVariants({ variant: 'ghost', size: 'icon' }),
  {
    variants: {
      size: {
        sm: 'h-8 w-8',
        md: 'h-10 w-10',
        lg: 'h-12 w-12',
      },
    },
    defaultVariants: {
      size: 'md',
    },
  }
);
```

## External Dependencies

### New Dependencies to Install

**shadcn/ui Core:**
- `tailwindcss-animate` - Animation utilities for shadcn components
- `class-variance-authority` - Variant management for component APIs
- `clsx` - Conditional className utility
- `tailwind-merge` - Merge Tailwind classes without conflicts

**Dark Mode:**
- `next-themes` - Theme management with SSR support

**Icons (if not already installed):**
- `lucide-react` - Icon library used by shadcn components

**Justification:**
- **tailwindcss-animate**: Required for smooth component transitions (accordion, dialog, dropdown animations)
- **class-variance-authority**: Powers shadcn's variant API, enabling type-safe component variants
- **clsx + tailwind-merge**: Essential for conditional styling without className conflicts
- **next-themes**: Industry-standard dark mode solution with SSR support, local storage persistence

**Installation Commands:**
```bash
cd apps/web
pnpm add tailwindcss-animate class-variance-authority clsx tailwind-merge
pnpm add next-themes
pnpm add lucide-react  # If not already installed
```

## Performance Considerations

**Bundle Size Impact:**
- shadcn/ui components are tree-shakeable (only imported components bundled)
- Estimated impact: +50KB gzipped for full component set
- Individual component cost: 2-5KB gzipped each
- CSS variables add ~3KB (minimal overhead)

**Runtime Performance:**
- No performance degradation (shadcn uses native HTML + Tailwind)
- Radix UI primitives are highly optimized for accessibility without perf cost
- Dark mode switching: instant (CSS variable swap, no re-render)

**Optimization Strategies:**
- Lazy load Dialog/Sheet components (import() for modal-heavy pages)
- Use React.memo() for Card lists with many items
- Implement virtual scrolling for large contact lists (react-window)

## Migration Path

**Week 1: Foundation**
1. Run `npx shadcn@latest init`
2. Install all 20 components
3. Configure design tokens in globals.css
4. Set up ThemeProvider and theme toggle

**Week 2: Refactor Contact Management**
1. Convert ContactForm (Day 1-2)
2. Convert ContactCard (Day 3)
3. Convert ContactDeleteDialog (Day 4)
4. Update contact list page (Day 5)

**Week 3: Refactor Authentication**
1. Convert login page (Day 1)
2. Convert signup page (Day 2)
3. Convert password reset flow (Day 3)
4. Testing and QA (Day 4-5)

**Week 4: Documentation & Testing**
1. Write component usage docs
2. Create accessibility test suite
3. Set up visual regression tests
4. Team review and feedback
